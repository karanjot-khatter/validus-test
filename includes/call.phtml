<?php
include_once("includes/database.php");
include_once("includes/utilities.php");

?>

<link rel="stylesheet" type="text/css" href="assets/css/style.css">
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="assets/js/main.js"></script>


<body>
<div id="fund-info">
    <div class="dashboard-body">

        <table>
            <tr>
                <td></td>
                <td></td>
                <?php foreach (getFundData() as $fund) :?>
                    <?php
                    $fundId = $fund['fund_id'];
                    ?>
                <td style="color: gray"><?php echo $fundId?></td>
                <?php endforeach ?>
            </tr>

            <tr>
                <th>Date</th>
                <th>Call #</th>
                <?php foreach (getFundData() as $fund) :?>
                <?php
                $fundName = $fund['fund_name'];
                ?>
                <th><?php echo $fundName ?></th>
                <?php endforeach ?>
            </tr>
       <?php foreach (getDataCall() as $call): ?>

       <?php
           $date = $call['date'];
           $ukDate = date("d/m/Y", strtotime($date));
       ?>
           <tr>
                <td><?php echo $ukDate; ?></td>
                <td><?php echo $id = $call['call_id']; ?></td>
                <?php foreach (getFundData() as $fund) :?>
                <?php
                $fundId = $fund['fund_id'];
                $fundInvestment = getFundInvestment($id, $fundId );
                ?>
                <?php if ($capitalRequirement = $fundInvestment['investment_amount']):?>
                    <td><?php echo $capitalRequirement?></td>
                    <?php else: ?>
                        <td><?php echo '-'?></td>
                <?php endif;?>
        <?php endforeach ?>
            </tr>

       <?php endforeach ?>

        </table>
    </div>
</div>
</body>

<body>
<div id="new-call-body">

    <div class="submit-form-fields">

        <form id="callform" method="POST">

            <div class="section">
                <label>Date</label>
                <input type="text" id='date' name="date" placeholder="<?php echo date("d/m/Y")?>"disabled>
            </div>

            <div class="section">
                <label>Rules</label>
                <input type="text" id="rules" name="rules" placeholder="First In First Out (FIFO)" disabled>
            </div>

            <div class="section">
                <label>Investment Name</label>
                <input type="text" id="name" name="name" value="<?php echo 'Investment' . ' '. ++$id ?>"readonly>
            </div>

            <div class="section">
                <label>Capital Required for Investment</label>
                <input id='currency' placeholder="$" disabled>
                <input id="capital" type="text" name="capital" value="10,000,000">
            </div>

            <input id='calculate' type="submit" id="calculate" value="Calculate" onclick="ValidateHidePrivate()">

        </form>

    </div>

    <?php

    if (isset($_POST["capital"])) {
        //strip tags - removes threat of sql injection...
        $paramCapital = strip_tags($_POST["capital"]);
        $paramCapital = turnIntoFloat($paramCapital);
        $paramName = strip_tags($_POST['name']);
        $usDate = date('Y/m/d');

    }

    ?>

        <div class="commitment-table">

            <table id="commitment">
                <tr>
                    <th>Commitment_ID</th>
                    <th>Fund_ID </th>
                    <th>Date</th>
                    <th>Fund</th>
                    <th>Commited Amounts</th>
                    <th>Undrawn Capital Commitment before Current Drawdown Notice</th>
                    <th class="hidden-commitment-columns">Total Drawdown Notice</th>
                    <th class="hidden-commitment-columns">Undrawn Capital Commitment after Current Drawdown Notice</th>
                </tr>

                <tr>
                    <?php foreach (getCommitmentData() as $commitmentData) :?>
                        <?php
                        $commitmentId = $commitmentData['id'];
                        $commitmentFund = $commitmentData['fund_id'];
                        $commitmentDate = $commitmentData['date'];
                        $commitmentAmount = $commitmentData['amount'];

                        $ukDate =  date("d/m/Y", strtotime($commitmentDate));
                        $beforeCurrentNotice = beforeCurrentNotice($commitmentId, $commitmentAmount);

                        $notice = totalNotice($paramCapital, $beforeCurrentNotice);

                        $paramCapital = $paramCapital - $notice;


                        ?>
                    <td><strong><?php echo $commitmentId ?></strong></td>
                    <td><strong><?php echo $commitmentFund ?></strong></td>
                    <td><?php echo $ukDate ?></td>
                    <td style="text-align: left;"><?php echo 'fund '. $commitmentFund ?></td>
                    <td><?php echo $commitmentAmount ?></td>
                    <td><?php echo $beforeCurrentNotice ?></td>
                    <td class="hidden-commitment-columns hidden-input"><?php echo $notice ? number_format($notice, 2) : '-'?></td>
                    <td class="hidden-commitment-columns hidden-input"><?php echo '' ?></td>
                </tr>

                <?php endforeach ?>




            </table>

        </div>

</div>

</body>